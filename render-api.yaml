# Render configuration for API backend only
version: "1"

services:
  - type: web
    name: biochar-rag-api
    env: python
    buildCommand: "pip install -r requirements.txt"
    startCommand: "gunicorn biochar_rag_api:app --host 0.0.0.0 --port $PORT --workers 2 --worker-class uvicorn.workers.UvicornWorker"
    plan: starter
    
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: TOGETHER_API_KEY
        sync: false  # Set this manually in Render dashboard
      - key: EMBEDDINGS_DRIVE_ID
        sync: false  # Set this manually in Render dashboard
      - key: MAX_CONTEXT_CHUNKS
        value: "5"
      - key: MAX_TOKENS
        value: "1000"
      - key: TEMPERATURE
        value: "0.7"
      - key: EMBEDDING_MODEL
        value: "BAAI/bge-small-en-v1.5"
      - key: TOKENIZERS_PARALLELISM
        value: "false"

    # Health check configuration
    healthCheckPath: "/health"
    
    # Auto-deploy on git push
    autoDeploy: true